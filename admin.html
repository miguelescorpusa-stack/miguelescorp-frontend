<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Administrativo ‚Äî Migueles Corp</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#ffffff; --fg:#111111; --muted:#666; --ok:#0a7; --err:#b00; --cta:#111;
      --bord:#ddd; --focus:#000;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background:var(--bg); color:var(--fg); line-height:1.5;
    }
    .wrap{max-width:780px; margin:32px auto; padding:0 16px}
    h1{font-size:clamp(22px,4vw,30px); margin:0 0 6px}
    p, label{font-size:clamp(16px,2.6vw,18px)}
    a{color:var(--cta); text-decoration:none; border-bottom:2px solid var(--cta); padding-bottom:1px}
    a:focus{outline:3px solid var(--focus); outline-offset:2px}

    .card{border:2px solid var(--bord); border-radius:14px; padding:18px; margin-top:12px}
    .row{margin-top:12px}
    label{display:block; margin-bottom:6px; font-weight:600}
    input{
      width:100%; padding:12px 14px; border-radius:12px; border:2px solid var(--bord);
      font-size:clamp(16px,2.8vw,18px);
    }
    input:focus{outline:3px solid var(--focus); border-color:var(--focus)}
    .hint{color:var(--muted); font-size:14px}

    button{
      margin-top:16px; padding:12px 18px; border-radius:12px; border:2px solid #000; background:#000; color:#fff;
      font-weight:700; cursor:pointer; font-size:clamp(16px,2.8vw,18px);
    }
    button[disabled]{opacity:.6; cursor:not-allowed}
    .msg{margin-top:14px; font-weight:700}
    .ok{color:var(--ok)} .err{color:var(--err)}
  </style>
</head>
<body>
  <main class="wrap" aria-describedby="page-desc">
    <p><a href="/index.html" aria-label="Volver al inicio">‚Üê Volver al inicio</a></p>
    <h1>üõ†Ô∏è Panel Administrativo</h1>
    <p id="page-desc" class="hint">Registra env√≠os nuevos. Los datos se env√≠an a <code>https://www.miguelescorp.com/shipments</code>.</p>

    <section class="card" aria-labelledby="sec-form">
      <h2 id="sec-form" style="margin:0 0 6px">Cargar env√≠o</h2>

      <div class="row">
        <label for="inpTracking">N√∫mero de env√≠o <span class="hint">(tracking_number)</span></label>
        <input id="inpTracking" name="tracking_number" placeholder="MC-000123" autocomplete="off" />
      </div>

      <div class="row">
        <label for="inpCliente">Nombre del cliente <span class="hint">(ref_code)</span></label>
        <input id="inpCliente" name="ref_code" placeholder="Juan Perez" autocomplete="off" />
      </div>

      <div class="row">
        <label for="inpEstado">Estado <span class="hint">(pending | in_transit | delivered)</span></label>
        <input id="inpEstado" name="status" placeholder="pending" autocomplete="off" />
      </div>

      <button id="btnGuardar" type="button">Guardar env√≠o</button>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>
  </main>

  <script>
    // === Config ===
    const API_BASE = "https://www.miguelescorp.com"; // backend de producci√≥n

    // Utilidad accesible para mensajes
    function setMsg(text, ok=true){
      const $m = document.getElementById("msg");
      $m.className = "msg " + (ok ? "ok" : "err");
      $m.textContent = (ok ? "‚úÖ " : "‚ùå ") + text;
    }

    async function guardarEnvio(){
      const $btn = document.getElementById("btnGuardar");
      const tracking = document.getElementById("inpTracking").value.trim();
      const cliente  = document.getElementById("inpCliente").value.trim();
      const estado   = document.getElementById("inpEstado").value.trim();

      // Validaci√≥n m√≠nima
      if(!tracking || !cliente || !estado){
        setMsg("Completa los tres campos: n√∫mero, cliente y estado.", false);
        return;
      }
      // Normalizamos valores recomendados
      const statusNorm = estado.toLowerCase().replace(/\s+/g, "_"); // "in transit" -> "in_transit"

      const payload = {
        ref_code: cliente,            // usamos el nombre como referencia
        tracking_number: tracking,    // n√∫mero de env√≠o
        status: statusNorm            // pending | in_transit | delivered
      };

      try{
        $btn.disabled = true;
        setMsg("Enviando‚Ä¶");

        const res = await fetch(`${API_BASE}/shipments`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));

        if(res.ok){
          setMsg("Env√≠o registrado con √©xito.");
          // Limpieza
          document.getElementById("inpTracking").value = "";
          document.getElementById("inpCliente").value = "";
          document.getElementById("inpEstado").value = "";
          console.log("Creado:", data);
        }else{
          // Mensaje claro para 404/405/409/500
          const detail = data?.error || `HTTP ${res.status}`;
          setMsg(`Error al registrar: ${detail}`, false);
          console.error("Detalle:", data);
        }
      }catch(err){
        setMsg("No se pudo conectar con el backend.", false);
        console.error(err);
      }finally{
        $btn.disabled = false;
      }
    }

    document.getElementById("btnGuardar").addEventListener("click", guardarEnvio);

    // Accesibilidad: Enter para enviar desde el √∫ltimo campo
    document.getElementById("inpEstado").addEventListener("keydown", e => {
      if(e.key === "Enter"){ guardarEnvio(); }
    });
  </script>
</body>
</html>
